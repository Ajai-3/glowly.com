<!DOCTYPE html>
<html lang="en">
<%- include('partials/head') %> 
<body class="auth-body">

    <div class="auth-container">
        <form action="/reset-password" method="POST" onsubmit="return validatePassword()">
            <h3 class="m-4">Reset Your Password...!</h3>
            <p style="color: rgb(0, 144, 12);">
                <%= email ? email : '' %>
            </p>
            <% if (msg) { %>
                <p style="color: red;"><%= msg %></p>
            <% } %>
            <input type="hidden" name="email" value="<%= email %>" />
            <div class="wave-group">
                <input type="password" id="password" class="input password" name="password" required>
                <span class="bar"></span>
                <label class="label">
                    <span class="label-char" style="--index: 0">N</span>
                    <span class="label-char" style="--index: 1">e</span>
                    <span class="label-char" style="--index: 2">w</span>
                    <span class="label-char" style="--index: 3">&nbsp;</span>
                    <span class="label-char" style="--index: 4">P</span>
                    <span class="label-char" style="--index: 6">a</span> 
                    <span class="label-char" style="--index: 5">s</span>
                    <span class="label-char" style="--index: 6">s</span>
                    <span class="label-char" style="--index: 7">w</span>
                    <span class="label-char" style="--index: 8">o</span>
                    <span class="label-char" style="--index: 9">r</span>
                    <span class="label-char" style="--index: 10">d</span>
                </label>
                <button type="button" class="togglePassword" aria-label="Show password"><i class="fa-solid fa-eye"></i></button>
            </div>
            <div id="error4" class="error-message"></div>
            <div class="wave-group">
                <input type="password" id="confirmPassword" class="input password" name="confirmPassword" required>
                <span class="bar"></span>
                <label class="label">
                    <span class="label-char" style="--index: 0">N</span>
                    <span class="label-char" style="--index: 1">e</span>
                    <span class="label-char" style="--index: 2">w</span>
                    <span class="label-char" style="--index: 3">&nbsp;</span>
                    <span class="label-char" style="--index: 4">P</span>
                    <span class="label-char" style="--index: 6">a</span> 
                    <span class="label-char" style="--index: 5">s</span>
                    <span class="label-char" style="--index: 6">s</span>
                    <span class="label-char" style="--index: 7">w</span>
                    <span class="label-char" style="--index: 8">o</span>
                    <span class="label-char" style="--index: 9">r</span>
                    <span class="label-char" style="--index: 10">d</span>
                </label>
                <button type="button" class="togglePassword" aria-label="Show password"><i class="fa-solid fa-eye"></i></button>
            </div>
            <div id="error5" class="error-message"></div>
            <button type="submit" class="btn m-3 action-btn">Confirm</button>
        </form>
    </div>  

</body>
<%- include('partials/footer') %>

<script>
    document.querySelectorAll('.togglePassword').forEach(button => {
        button.addEventListener('click', () => {
            const passwordInput = button.previousElementSibling;
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
            button.innerHTML = type === 'password' ? '<i class="fa-solid fa-eye"></i>' : '<i class="fa-solid fa-eye-slash"></i>';
        });
    });

    const passwordError = document.getElementById('error4');
    const repeatPasswordError = document.getElementById('error5');

    function validatePassword() {
        const passwordInput = document.getElementById('password');
        const repeatPasswordInput = document.getElementById('confirmPassword');
        
        const passwordValue = passwordInput.value;
        const repeatPasswordValue = repeatPasswordInput.value;
        const hasAlphabet = /[a-zA-Z]/;
        const hasDigit = /\d/;

        // Reset previous errors
        passwordError.style.display = "none"; 
        passwordError.textContent = "";
        repeatPasswordError.style.display = "none";
        repeatPasswordError.textContent = "";

        if (passwordValue.length < 8) {
            passwordError.style.display = "block"; 
            passwordError.textContent = "Password must be at least 8 characters.";
            return false;
        } else if (!hasAlphabet.test(passwordValue) || !hasDigit.test(passwordValue)) {
            passwordError.style.display = "block"; 
            passwordError.textContent = "Password must contain both letters and numbers.";
            return false;
        }

        if (passwordValue !== repeatPasswordValue) {
            repeatPasswordError.style.display = "block";
            repeatPasswordError.textContent = "Passwords do not match.";
            return false;
        }

        return true;  
    }
</script> 

</html>
