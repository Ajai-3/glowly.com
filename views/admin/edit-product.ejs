<!DOCTYPE html>
<html lang="en">

<%- include('partials/head') %>

<!-- Main Content Section -->
<div class="main-content">
  <!-- Header Section -->
  <div class="header">
    <div class="search-bar m-0">
      <form action="/admin/search" method="GET">
        <input type="text" name="search" placeholder="Search" readonly>
        <button class="admin-search-button"><i class="fas fa-search"></i></button>
      </form>
    </div>
    <div class="admin-profile mx-3">
      <a href="/admin/settings">
        <i class="fa-solid fa-circle-user"></i>
      </a>
    </div>
  </div>

  <!-- Breadcrumbs Section -->
  <div class="breadcrumbs">
    <a href="/admin/products">Products</a> > <a href="/admin/edit-product/<%= product._id %>"> Edit Product</a>
  </div>

 <!-- Edit Products Container -->
 <form action="/admin/edit-product/<%= product._id %>" method="POST" enctype="multipart/form-data">
  <div class="edit-products-container row">
    <div class="add-products-container1 col-6">
      <!-- Form To Edit Product -->
      <h4>Edit Product</h4>

      <!-- Product Name -->
      <div>
        <label for="productName">Product Name</label>
        <input type="text" name="productName" id="productName" value="<%= product.title %>" placeholder="Type product name">
      </div>

      <!-- Select Brand -->
      <div class="add-products-container-center">
        <div>
          <label for="brand">Select Brand</label>
          <select name="brand" id="brand">
            <option value="">Select Brand</option>
            <% brands.forEach(brand => { %>
            <option value="<%= brand._id %>" <%= product.brandId && product.brandId._id.toString() === brand._id.toString() ? 'selected' : '' %>><%= brand.brandName %></option>
            <% }) %>
          </select>
        </div>
      </div>

      <!-- Description -->
      <label for="description">Description</label><br>
      <textarea id="description" name="description" placeholder="Enter product description here..."><%= product.description %></textarea>

      <!-- Category And Subcategory -->
      <div class="add-products-container-center">
        <div>
          <label for="category">Category</label><br>
          <select name="category" id="category" onchange="updateSubCategories()">
            <option value="">Select Category</option>
            <% categories.forEach(category => { %>
            <option value="<%= category._id %>" <%= product.categoryId && product.categoryId._id.toString() === category._id.toString() ? 'selected' : '' %>><%= category.name %></option>
            <% }) %>
          </select>
        </div>
        <div>
          <label for="subCategory">Sub Category</label><br>
          <select name="subCategory" id="subCategory">
            <option value="">Select Sub Category</option>
          </select>
        </div>
      </div>
    </div>
    <div class="add-products-container1">
      <!-- Variants -->
      <div id="variants-section">
        <% product.variants.forEach((variant, index) => { %>
        <div class="variant">
          <h5>Variant <%= index + 1 %></h5>
          <div class="add-products-container-center d-flex align-items-end">
            <div>
              <label for="variantColor<%= index %>">Color</label>
              <input type="color" name="variants[<%= index %>][color]" id="variantColor<%= index %>" value="<%= variant.color %>">
            </div>
            <div>
              <label for="variantShade<%= index %>">Shade</label>
              <input type="text" name="variants[<%= index %>][shade]" id="variantShade<%= index %>" value="<%= variant.shade %>" placeholder="Shade">
            </div>
            <div>
              <button class="btn-primary">Remove Variant</button>
            </div>
          </div>
          <div class="d-flex justify-content-between">
            <div>
              <label for="variantStockQuantity<%= index %>">Stock Quantity</label>
              <input type="number" name="variants[<%= index %>][stockQuantity]" id="variantStockQuantity<%= index %>" value="<%= variant.stockQuantity %>" min="0">
            </div>
            <div>
              <label for="variantRegularPrice<%= index %>">Regular Price</label>
              <input type="number" name="variants[<%= index %>][regularPrice]" id="variantRegularPrice<%= index %>" value="<%= variant.regularPrice %>" min="0">
            </div>
            <div>
              <label for="variantSalePrice<%= index %>">Sale Price</label>
              <input type="number" name="variants[<%= index %>][salePrice]" id="variantSalePrice<%= index %>" value="<%= variant.salePrice %>" min="0">
            </div>
          </div>
          <div>
            <div class="my-2">
              <% variant.images.forEach(image => { %>
                <img src="<%= image %>" alt="Variant Image" style="width: 70px; height: 70px;">
                <% }) %>
            </div>
            <label for="variantImages<%= index %>">Images</label>
            <input type="file" class="mb-2" name="variants[<%= index %>][images][]" id="variantImages<%= index %>" multiple>
          </div>
        </div>
        <% }) %>
        <button class="my-3">Add Varient</button>
      </div>

      <button type="submit" class="add-product-btn2 my-3">Update Product</button>
    </div>
  </div>
</form>


  <!-- JavaScript Section -->
  <script>

  function updateSubCategories() {
    const categoryId = document.getElementById('category').value;
    const subCategorySelect = document.getElementById('subCategory');
    subCategorySelect.innerHTML = '<option value="">Select Sub Category</option>'; 

    const categories = <%- JSON.stringify(categories) %>;
    const productSubCategoryId = '<%= product.subcategoryId ? product.subcategoryId._id.toString() : '' %>';

    categories.forEach(category => {
      if (category._id.toString() === categoryId) {
        category.subcategories.forEach(subcategory => {
          const option = document.createElement('option');
          option.value = subcategory._id;
          option.text = subcategory.name;
          if (subcategory._id.toString() === productSubCategoryId) {
            option.selected = true; 
          }
          subCategorySelect.appendChild(option);
        });
      }
    });
  }


  updateSubCategories();
  </script>

  <%- include('partials/footer') %>

</html>